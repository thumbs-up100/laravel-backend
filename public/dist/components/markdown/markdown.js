/**
 * @module       markdown-js
 * @author       Dominic Baggott
 * @see          https://github.com/evilstreak/markdown-js
 * @license      MIT
 * @version      0.6.0-beta1
 * @requires     module:jquery
 */
!function(t){function e(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function n(){var t=require("util");return"Markdown.mk_block( "+t.inspect(this.toString())+", "+t.inspect(this.trailing)+", "+t.inspect(this.lineNumber)+" )"}function i(t){for(var e=0,n=-1;-1!==(n=t.indexOf("\n",n+1));)e++;return e}function o(t,e){function n(t){this.len_after=t,this.name="close_"+e}var i=t+"_state",o="strong"==t?"em_state":"strong_state";return function(r,s){if(this[i][0]==e)return this[i].shift(),[r.length,new n(r.length-e.length)];var a=this[o].slice(),l=this[i].slice();this[i].unshift(e);var c=this.processInline(r.substr(e.length)),h=c[c.length-1];this[i].shift();if(h instanceof n){c.pop();var u=r.length-h.len_after;return[u,[t].concat(c)]}return this[o]=a,this[i]=l,[e.length,e]}}function r(t){for(var e=t.split(""),n=[""],i=!1;e.length;){var o=e.shift();switch(o){case" ":i?n[n.length-1]+=o:n.push("");break;case"'":case'"':i=!i;break;case"\\":o=e.shift();default:n[n.length-1]+=o}}return n}function s(t){return m(t)&&t.length>1&&"object"==typeof t[1]&&!m(t[1])?t[1]:void 0}function l(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function c(t){if("string"==typeof t)return l(t);var e=t.shift(),n={},i=[];for(!t.length||"object"!=typeof t[0]||t[0]instanceof Array||(n=t.shift());t.length;)i.push(arguments.callee(t.shift()));var o="";for(var r in n)o+=" "+r+'="'+l(n[r])+'"';return"img"==e||"br"==e||"hr"==e?"<"+e+o+"/>":"<"+e+o+">"+i.join("")+"</"+e+">"}function h(t,e,n){var i;n=n||{};var o=t.slice(0);"function"==typeof n.preprocessTreeNode&&(o=n.preprocessTreeNode(o,e));var r=s(o);if(r){o[1]={};for(i in r)o[1][i]=r[i];r=o[1]}if("string"==typeof o)return o;switch(o[0]){case"header":o[0]="h"+o[1].level,delete o[1].level;break;case"bulletlist":o[0]="ul";break;case"numberlist":o[0]="ol";break;case"listitem":o[0]="li";break;case"para":o[0]="p";break;case"markdown":o[0]="html",r&&delete r.references;break;case"code_block":o[0]="pre",i=r?2:1;var a=["code"];a.push.apply(a,o.splice(i)),o[i]=a;break;case"inlinecode":o[0]="code";break;case"img":o[1].src=o[1].href,delete o[1].href;break;case"linebreak":o[0]="br";break;case"link":o[0]="a";break;case"link_ref":o[0]="a";var l=e[r.ref];if(!l)return r.original;delete r.ref,r.href=l.href,l.title&&(r.title=l.title),delete r.original;break;case"img_ref":o[0]="img";var l=e[r.ref];if(!l)return r.original;delete r.ref,r.src=l.href,l.title&&(r.title=l.title),delete r.original}if(i=1,r){for(var c in o[1])i=2;1===i&&o.splice(i,1)}for(;i<o.length;++i)o[i]=arguments.callee(o[i],e,n);return o}function u(t){for(var e=s(t)?2:1;e<t.length;)"string"==typeof t[e]?e+1<t.length&&"string"==typeof t[e+1]?t[e]+=t.splice(e+1,1)[0]:++e:(arguments.callee(t[e]),++e)}var d=t.Markdown=function v(t){switch(typeof t){case"undefined":this.dialect=v.dialects.Gruber;break;case"object":this.dialect=t;break;default:if(!(t in v.dialects))throw new Error("Unknown Markdown dialect '"+String(t)+"'");this.dialect=v.dialects[t]}this.em_state=[],this.strong_state=[],this.debug_indent=""};t.parse=function(t,e){var n=new d(e);return n.toTree(t)},t.toHTML=function(e,n,i){var o=t.toHTMLTree(e,n,i);return t.renderJsonML(o)},t.toHTMLTree=function(t,e,n){"string"==typeof t&&(t=this.parse(t,e));var i=s(t),o={};i&&i.references&&(o=i.references);var r=h(t,o,n);return u(r),r};var f=d.mk_block=function(t,i,o){1==arguments.length&&(i="\n\n");var r=new String(t);return r.trailing=i,r.inspect=n,r.toSource=e,void 0!=o&&(r.lineNumber=o),r};d.prototype.split_blocks=function(t,e){var n,o=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,r=[],s=1;for(null!=(n=/^(\s*\n)/.exec(t))&&(s+=i(n[0]),o.lastIndex=n[0].length);null!==(n=o.exec(t));)r.push(f(n[1],n[2],s)),s+=i(n[0]);return r},d.prototype.processBlock=function(t,e){var n=this.dialect.block,i=n.__order__;if("__call__"in n)return n.__call__.call(this,t,e);for(var o=0;o<i.length;o++){var r=n[i[o]].call(this,t,e);if(r)return(!m(r)||r.length>0&&!m(r[0]))&&this.debug(i[o],"didn't return a proper array"),r}return[]},d.prototype.processInline=function(t){return this.dialect.inline.__call__.call(this,String(t))},d.prototype.toTree=function(t,e){var n=t instanceof Array?t:this.split_blocks(t),i=this.tree;try{for(this.tree=e||this.tree||["markdown"];n.length;){var o=this.processBlock(n.shift(),n);o.length&&this.tree.push.apply(this.tree,o)}return this.tree}finally{e&&(this.tree=i)}},d.prototype.debug=function(){var t=Array.prototype.slice.call(arguments);t.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,t),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,t)},d.prototype.loop_re_over_block=function(t,e,n){for(var i,o=e.valueOf();o.length&&null!=(i=t.exec(o));)o=o.substr(i[0].length),n.call(this,i);return o},d.dialects={},d.dialects.Gruber={block:{atxHeader:function(t,e){var n=t.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(!n)return void 0;var i=["header",{level:n[1].length}];return Array.prototype.push.apply(i,this.processInline(n[2])),n[0].length<t.length&&e.unshift(f(t.substr(n[0].length),t.trailing,t.lineNumber+2)),[i]},setextHeader:function(t,e){var n=t.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!n)return void 0;var i="="===n[2]?1:2,o=["header",{level:i},n[1]];return n[0].length<t.length&&e.unshift(f(t.substr(n[0].length),t.trailing,t.lineNumber+2)),[o]},code:function(t,e){var n=[],i=/^(?: {0,3}\t| {4})(.*)\n?/;if(!t.match(i))return void 0;t:for(;;){var o=this.loop_re_over_block(i,t.valueOf(),function(t){n.push(t[1])});if(o.length){e.unshift(f(o,t.trailing));break t}if(!e.length)break t;if(!e[0].match(i))break t;n.push(t.trailing.replace(/[^\n]/g,"").substring(2)),t=e.shift()}return[["code_block",n.join("\n")]]},horizRule:function(t,e){var n=t.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!n)return void 0;var i=[["hr"]];return n[1]&&i.unshift.apply(i,this.processBlock(n[1],[])),n[3]&&e.unshift(f(n[3])),i},lists:function(){function t(t){return new RegExp("(?:^("+l+"{0,"+t+"} {0,3})("+r+")\\s+)|(^"+l+"{0,"+(t-1)+"}[ ]{0,4})")}function e(t){return t.replace(/ {0,3}\t/g,"    ")}function n(t,e,n,i){if(e)return void t.push(["para"].concat(n));var o=t[t.length-1]instanceof Array&&"para"==t[t.length-1][0]?t[t.length-1]:t;i&&t.length>1&&n.unshift(i);for(var r=0;r<n.length;r++){var s=n[r],a="string"==typeof s;a&&o.length>1&&"string"==typeof o[o.length-1]?o[o.length-1]+=s:o.push(s)}}function i(t,e){for(var n=new RegExp("^("+l+"{"+t+"}.*?\\n?)*$"),i=new RegExp("^"+l+"{"+t+"}","gm"),o=[];e.length>0;){if(n.exec(e[0])){var r=e.shift(),s=r.replace(i,"");o.push(f(s,r.trailing,r.lineNumber))}break}return o}function o(t,e,n){var i=t.list,o=i[i.length-1];if(!(o[1]instanceof Array&&"para"==o[1][0]))if(e+1==n.length)o.push(["para"].concat(o.splice(1)));else{var r=o.pop();o.push(["para"].concat(o.splice(1)),r)}}var r="[*+-]|\\d+\\.",s=/[*+-]/,a=new RegExp("^( {0,3})("+r+")[ 	]+"),l="(?: {0,3}\\t| {4})";return function(r,l){function c(t){var e=s.exec(t[2])?["bulletlist"]:["numberlist"];return p.push({list:e,indent:t[1]}),e}var h=r.match(a);if(!h)return void 0;for(var u,d,p=[],f=c(h),m=!1,v=[p[0].list];;){for(var b=r.split(/(?=\n)/),y="",k=0;k<b.length;k++){var _="",w=b[k].replace(/^\n/,function(t){return _=t,""}),x=t(p.length);if(h=w.match(x),void 0!==h[1]){y.length&&(n(u,m,this.processInline(y),_),m=!1,y=""),h[1]=e(h[1]);var C=Math.floor(h[1].length/4)+1;if(C>p.length)f=c(h),u.push(f),u=f[1]=["listitem"];else{var $=!1;for(d=0;d<p.length;d++)if(p[d].indent==h[1]){f=p[d].list,p.splice(d+1),$=!0;break}$||(C++,C<=p.length?(p.splice(C),f=p[C-1].list):(f=c(h),u.push(f))),u=["listitem"],f.push(u)}_=""}w.length>h[0].length&&(y+=_+w.substr(h[0].length))}y.length&&(n(u,m,this.processInline(y),_),m=!1,y="");var S=i(p.length,l);S.length>0&&(g(p,o,this),u.push.apply(u,this.toTree(S,[])));var P=l[0]&&l[0].valueOf()||"";if(!P.match(a)&&!P.match(/^ /))break;r=l.shift();var z=this.dialect.block.horizRule(r,l);if(z){v.push.apply(v,z);break}g(p,o,this),m=!0}return v}}(),blockquote:function(t,e){if(!t.match(/^>/m))return void 0;var n=[];if(">"!=t[0]){for(var i=t.split(/\n/),o=[];i.length&&">"!=i[0][0];)o.push(i.shift());t=i.join("\n"),n.push.apply(n,this.processBlock(o.join("\n"),[]))}for(;e.length&&">"==e[0][0];){var r=e.shift();t=new String(t+t.trailing+r),t.trailing=r.trailing}var s=t.replace(/^> ?/gm,"");this.tree;return n.push(this.toTree(s,["blockquote"])),n},referenceDefn:function(t,e){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!t.match(n))return void 0;s(this.tree)||this.tree.splice(1,0,{});var i=s(this.tree);void 0===i.references&&(i.references={});var o=this.loop_re_over_block(n,t,function(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1));var e=i.references[t[1].toLowerCase()]={href:t[2]};void 0!==t[4]?e.title=t[4]:void 0!==t[5]&&(e.title=t[5])});return o.length&&e.unshift(f(o,t.trailing)),[]},para:function(t,e){return[["para"].concat(this.processInline(t))]}}},d.dialects.Gruber.inline={__oneElement__:function(t,e,n){var i,o;e=e||this.dialect.inline.__patterns__;var r=new RegExp("([\\s\\S]*?)("+(e.source||e)+")");if(i=r.exec(t),!i)return[t.length,t];if(i[1])return[i[1].length,i[1]];var o;return i[2]in this.dialect.inline&&(o=this.dialect.inline[i[2]].call(this,t.substr(i.index),i,n||[])),o=o||[i[2].length,i[2]]},__call__:function(t,e){function n(t){"string"==typeof t&&"string"==typeof o[o.length-1]?o[o.length-1]+=t:o.push(t)}for(var i,o=[];t.length>0;)i=this.dialect.inline.__oneElement__.call(this,t,e,o),t=t.substr(i.shift()),g(i,n);return o},"]":function(){},"}":function(){},"\\":function(t){return t.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)?[2,t[1]]:[1,"\\"]},"![":function(t){var e=t.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1)),e[2]=this.dialect.inline.__call__.call(this,e[2],/\\/)[0];var n={alt:e[1],href:e[2]||""};return void 0!==e[4]&&(n.title=e[4]),[e[0].length,["img",n]]}return e=t.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),e?[e[0].length,["img_ref",{alt:e[1],ref:e[2].toLowerCase(),original:e[0]}]]:[2,"!["]},"[":function b(t){var e=String(t),n=d.DialectHelpers.inline_until_char.call(this,t.substr(1),"]");if(!n)return[1,"["];var b,i,o=1+n[0],r=n[1];t=t.substr(o);var s=t.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(s){var a=s[1];if(o+=s[0].length,a&&"<"==a[0]&&">"==a[a.length-1]&&(a=a.substring(1,a.length-1)),!s[3])for(var l=1,c=0;c<a.length;c++)switch(a[c]){case"(":l++;break;case")":0==--l&&(o-=a.length-c,a=a.substring(0,c))}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],i={href:a||""},void 0!==s[3]&&(i.title=s[3]),b=["link",i].concat(r),[o,b]}return s=t.match(/^\s*\[(.*?)\]/),s?(o+=s[0].length,i={ref:(s[1]||String(r)).toLowerCase(),original:e.substr(0,o)},b=["link_ref",i].concat(r),[o,b]):1==r.length&&"string"==typeof r[0]?(i={ref:r[0].toLowerCase(),original:e.substr(0,o)},b=["link_ref",i,r[0]],[o,b]):[1,"["]},"<":function(t){var e;return null!=(e=t.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?e[3]?[e[0].length,["link",{href:"mailto:"+e[3]},e[3]]]:"mailto"==e[2]?[e[0].length,["link",{href:e[1]},e[1].substr("mailto:".length)]]:[e[0].length,["link",{href:e[1]},e[1]]]:[1,"<"]},"`":function(t){var e=t.match(/(`+)(([\s\S]*?)\1)/);return e&&e[2]?[e[1].length+e[2].length,["inlinecode",e[3]]]:[1,"`"]},"  \n":function(t){return[3,["linebreak"]]}},d.dialects.Gruber.inline["**"]=o("strong","**"),d.dialects.Gruber.inline.__=o("strong","__"),d.dialects.Gruber.inline["*"]=o("em","*"),d.dialects.Gruber.inline._=o("em","_"),d.buildBlockOrder=function(t){var e=[];for(var n in t)"__order__"!=n&&"__call__"!=n&&e.push(n);t.__order__=e},d.buildInlinePatterns=function(t){var e=[];for(var n in t)if(!n.match(/^__.*__$/)){var i=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");e.push(1==n.length?i:"(?:"+i+")")}e=e.join("|"),t.__patterns__=e;var o=t.__call__;t.__call__=function(t,n){return void 0!=n?o.call(this,t,n):o.call(this,t,e)}},d.DialectHelpers={},d.DialectHelpers.inline_until_char=function(t,e){for(var n=0,i=[];;){if(t[n]==e)return n++,[n,i];if(n>=t.length)return null;var o=this.dialect.inline.__oneElement__.call(this,t.substr(n));n+=o[0],i.push.apply(i,o.slice(1))}},d.subclassDialect=function(t){function e(){}function n(){}return e.prototype=t.block,n.prototype=t.inline,{block:new e,inline:new n}},d.buildBlockOrder(d.dialects.Gruber.block),d.buildInlinePatterns(d.dialects.Gruber.inline),d.dialects.Maruku=d.subclassDialect(d.dialects.Gruber),d.dialects.Maruku.processMetaHash=function(t){for(var e=r(t),n={},i=0;i<e.length;++i)if(/^#/.test(e[i]))n.id=e[i].substring(1);else if(/^\./.test(e[i]))n["class"]?n["class"]=n["class"]+e[i].replace(/./," "):n["class"]=e[i].substring(1);else if(/\=/.test(e[i])){var o=e[i].split(/\=/);n[o[0]]=o[1]}return n},d.dialects.Maruku.block.document_meta=function(t,e){if(t.lineNumber>1)return void 0;if(!t.match(/^(?:\w+:.*\n)*\w+:.*$/))return void 0;s(this.tree)||this.tree.splice(1,0,{});var n=t.split(/\n/);for(p in n){var i=n[p].match(/(\w+):\s*(.*)$/),o=i[1].toLowerCase(),r=i[2];this.tree[1][o]=r}return[]},d.dialects.Maruku.block.block_meta=function(t,e){var n=t.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!n)return void 0;var i,o=this.dialect.processMetaHash(n[2]);if(""===n[1]){var r=this.tree[this.tree.length-1];if(i=s(r),"string"==typeof r)return void 0;i||(i={},r.splice(1,0,i));for(a in o)i[a]=o[a];return[]}var l=t.replace(/\n.*$/,""),c=this.processBlock(l,[]);i=s(c[0]),i||(i={},c[0].splice(1,0,i));for(a in o)i[a]=o[a];return c},d.dialects.Maruku.block.definition_list=function(t,e){var n,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,o=["dl"];if(!(a=t.match(i)))return void 0;for(var r=[t];e.length&&i.exec(e[0]);)r.push(e.shift());for(var s=0;s<r.length;++s){var a=r[s].match(i),l=a[1].replace(/\n$/,"").split(/\n/),c=a[2].split(/\n:\s+/);for(n=0;n<l.length;++n)o.push(["dt",l[n]]);for(n=0;n<c.length;++n)o.push(["dd"].concat(this.processInline(c[n].replace(/(\n)\s+/,"$1"))))}return[o]},d.dialects.Maruku.inline["{:"]=function(t,e,n){if(!n.length)return[2,"{:"];var i=n[n.length-1];if("string"==typeof i)return[2,"{:"];var o=t.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!o)return[2,"{:"];var r=this.dialect.processMetaHash(o[1]),a=s(i);a||(a={},i.splice(1,0,a));for(var l in r)a[l]=r[l];return[o[0].length,""]},d.buildBlockOrder(d.dialects.Maruku.block),d.buildInlinePatterns(d.dialects.Maruku.inline);var g,m=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)};g=Array.prototype.forEach?function(t,e,n){return t.forEach(e,n)}:function(t,e,n){for(var i=0;i<t.length;i++)e.call(n||t,t[i],i,t)},t.renderJsonML=function(t,e){e=e||{},e.root=e.root||!1;var n=[];if(e.root)n.push(c(t));else for(t.shift(),!t.length||"object"!=typeof t[0]||t[0]instanceof Array||t.shift();t.length;)n.push(c(t.shift()));return n.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}());
