/**
 * @module       jquery-sortable.js
 * @author       Jonas von Andrian
 * @see          http://johnny.github.com/jquery-sortable/
 * @license      Modified BSD License (http://www.xfree86.org/3.3.6/COPYRIGHT2.html#5)
 * @version      0.9.13
 */
!function(t,i,o,e){function s(t,i){var o=Math.max(0,t[0]-i[0],i[0]-t[1]),e=Math.max(0,t[2]-i[1],i[1]-t[3]);return o+e}function n(i,o,e,s){var n=i.length,r=s?"offset":"position";for(e=e||0;n--;){var a=i[n].el?i[n].el:t(i[n]),h=a[r]();h.left+=parseInt(a.css("margin-left"),10),h.top+=parseInt(a.css("margin-top"),10),o[n]=[h.left-e,h.left+a.outerWidth()+e,h.top-e,h.top+a.outerHeight()+e]}}function r(t,i){var o=i.offset();return{left:t.left-o.left,top:t.top-o.top}}function a(t,i,o){i=[i.left,i.top],o=o&&[o.left,o.top];for(var e,n=t.length,r=[];n--;)e=t[n],r[n]=[n,s(e,i),o&&s(e,o)];return r=r.sort(function(t,i){return i[1]-t[1]||i[2]-t[2]||i[0]-t[0]})}function h(i){this.options=t.extend({},d,i),this.containers=[],this.options.rootGroup||(this.scrollProxy=t.proxy(this.scroll,this),this.dragProxy=t.proxy(this.drag,this),this.dropProxy=t.proxy(this.drop,this),this.placeholder=t(this.options.placeholder),i.isValidTarget||(this.options.isValidTarget=e))}function l(i,o){this.el=i,this.options=t.extend({},p,o),this.group=h.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;var e=this.rootGroup.options.itemPath;this.target=e?this.el.find(e):this.el,this.target.on(m.start,this.handle,t.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}var p={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},d={afterMove:function(t,i,o){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(t,i){return!0},onCancel:function(t,i,o,e){},onDrag:function(t,i,o,e){t.css(i)},onDragStart:function(i,o,e,s){i.css({height:i.outerHeight(),width:i.outerWidth()}),i.addClass(o.group.options.draggedClass),t("body").addClass(o.group.options.bodyClass)},onDrop:function(i,o,e,s){i.removeClass(o.group.options.draggedClass).removeAttr("style"),t("body").removeClass(o.group.options.bodyClass)},onMousedown:function(t,i,o){return o.target.nodeName.match(/^(input|select|textarea)$/i)?void 0:(o.preventDefault(),!0)},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(i,o,e){var s=t.extend({},i.data());return e?[o]:(o[0]&&(s.children=o),delete s.subContainers,delete s.sortable,s)},tolerance:0},c={},u=0,f={left:0,top:0,bottom:0,right:0},m={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},g="subContainers";h.get=function(t){return c[t.group]||(t.group===e&&(t.group=u++),c[t.group]=new h(t)),c[t.group]},h.prototype={dragInit:function(i,o){this.$document=t(o.el[0].ownerDocument);var e=t(i.target).closest(this.options.itemSelector);if(e.length){if(this.item=e,this.itemContainer=o,this.item.is(this.options.exclude)||!this.options.onMousedown(this.item,d.onMousedown,i))return;this.setPointer(i),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0}},drag:function(t){if(!this.dragging){if(!this.distanceMet(t)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,d.onDragStart,t),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(t),this.options.onDrag(this.item,r(this.pointer,this.item.offsetParent()),d.onDrag,t);var i=this.getPointer(t),o=this.sameResultBox,s=this.options.tolerance;(!o||o.top-s>i.top||o.bottom+s<i.top||o.left-s>i.left||o.right+s<i.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=e))},drop:function(t){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,d.onCancel,t),this.options.onDrop(this.item,this.getContainer(this.item),d.onDrop,t),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=e,this.dragging=!1)},searchValidTarget:function(t,i){t||(t=this.relativePointer||this.pointer,i=this.lastRelativePointer||this.lastPointer);for(var o=a(this.getContainerDimensions(),t,i),s=o.length;s--;){var n=o[s][0],h=o[s][1];if(!h||this.options.pullPlaceholder){var l=this.containers[n];if(!l.disabled){if(!this.$getOffsetParent()){var p=l.getItemOffsetParent();t=r(t,p),i=r(i,p)}if(l.searchValidTarget(t,i))return!0}}}this.sameResultBox&&(this.sameResultBox=e)},movePlaceholder:function(t,i,o,e){var s=this.lastAppendedItem;(e||!s||s[0]!==i[0])&&(i[o](this.placeholder),this.lastAppendedItem=i,this.sameResultBox=e,this.options.afterMove(this.placeholder,t,i))},getContainerDimensions:function(){return this.containerDimensions||n(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(t){return t.closest(this.options.containerSelector).data(o)},$getOffsetParent:function(){if(this.offsetParent===e){var t=this.containers.length-1,i=this.containers[t].getItemOffsetParent();if(!this.options.rootGroup)for(;t--;)if(i[0]!=this.containers[t].getItemOffsetParent()[0]){i=!1;break}this.offsetParent=i}return this.offsetParent},setPointer:function(t){var i=this.getPointer(t);if(this.$getOffsetParent()){var o=r(i,this.$getOffsetParent());this.lastRelativePointer=this.relativePointer,this.relativePointer=o}this.lastPointer=this.pointer,this.pointer=i},distanceMet:function(t){var i=this.getPointer(t);return Math.max(Math.abs(this.pointer.left-i.left),Math.abs(this.pointer.top-i.top))>=this.options.distance},getPointer:function(t){var i=t.originalEvent||t.originalEvent.touches&&t.originalEvent.touches[0];return{left:t.pageX||i.pageX,top:t.pageY||i.pageY}},setupDelayTimer:function(){var t=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){t.delayMet=!0},this.options.delay))},scroll:function(t){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(i){var o=this,e=["drag","drop","scroll"];t.each(e,function(t,e){o.$document[i](m[e],o[e+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=e},clearDimensions:function(){this.traverse(function(t){t._clearDimensions()})},traverse:function(t){t(this);for(var i=this.containers.length;i--;)this.containers[i].traverse(t)},_clearDimensions:function(){this.containerDimensions=e},_destroy:function(){c[this.options.group]=e}},l.prototype={dragInit:function(t){var i=this.rootGroup;!this.disabled&&!i.dragInitDone&&this.options.drag&&this.isValidDrag(t)&&i.dragInit(t,this)},isValidDrag:function(t){return 1==t.which||"touchstart"==t.type&&1==t.originalEvent.touches.length},searchValidTarget:function(t,i){var o=a(this.getItemDimensions(),t,i),e=o.length,s=this.rootGroup,n=!s.options.isValidTarget||s.options.isValidTarget(s.item,this);if(!e&&n)return s.movePlaceholder(this,this.target,"append"),!0;for(;e--;){var r=o[e][0],h=o[e][1];if(!h&&this.hasChildGroup(r)){var l=this.getContainerGroup(r).searchValidTarget(t,i);if(l)return!0}else if(n)return this.movePlaceholder(r,t),!0}},movePlaceholder:function(i,o){var e=t(this.items[i]),s=this.itemDimensions[i],n="after",r=e.outerWidth(),a=e.outerHeight(),h=e.offset(),l={left:h.left,right:h.left+r,top:h.top,bottom:h.top+a};if(this.options.vertical){var p=(s[2]+s[3])/2,d=o.top<=p;d?(n="before",l.bottom-=a/2):l.top+=a/2}else{var c=(s[0]+s[1])/2,u=o.left<=c;u?(n="before",l.right-=r/2):l.left+=r/2}this.hasChildGroup(i)&&(l=f),this.rootGroup.movePlaceholder(this,e,n,l)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),n(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var t,i=this.el;return t="relative"===i.css("position")||"absolute"===i.css("position")||"fixed"===i.css("position")?i:i.offsetParent()},hasChildGroup:function(t){return this.options.nested&&this.getContainerGroup(t)},getContainerGroup:function(i){var s=t.data(this.items[i],g);if(s===e){var n=this.$getChildren(this.items[i],"container");if(s=!1,n[0]){var r=t.extend({},this.options,{rootGroup:this.rootGroup,group:u++});s=n[o](r).data(o).group}t.data(this.items[i],g,s)}return s},$getChildren:function(i,o){var e=this.rootGroup.options,s=e[o+"Path"],n=e[o+"Selector"];return i=t(i),s&&(i=i.find(s)),i.children(n)},_serialize:function(i,o){var e=this,s=o?"item":"container",n=this.$getChildren(i,s).not(this.options.exclude).map(function(){return e._serialize(t(this),!o)}).get();return this.rootGroup.options.serialize(i,n,o)},traverse:function(i){t.each(this.items||[],function(o){var e=t.data(this,g);e&&e.traverse(i)}),i(this)},_clearDimensions:function(){this.itemDimensions=e},_destroy:function(){var i=this;this.target.off(m.start,this.handle),this.el.removeData(o),this.options.drop&&(this.group.containers=t.grep(this.group.containers,function(t){return t!=i})),t.each(this.items||[],function(){t.removeData(this,g)})}};var v={enable:function(){this.traverse(function(t){t.disabled=!1})},disable:function(){this.traverse(function(t){t.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(t){t._clearDimensions()})},destroy:function(){this.traverse(function(t){t._destroy()})}};t.extend(l.prototype,v),t.fn[o]=function(i){var s=Array.prototype.slice.call(arguments,1);return this.map(function(){var n=t(this),r=n.data(o);return r&&v[i]?v[i].apply(r,s)||this:(r||i!==e&&"object"!=typeof i||n.data(o,new l(n,i)),this)})}}(jQuery,window,"sortable");
